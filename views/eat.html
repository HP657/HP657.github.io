<!DOCTYPE html>
<html>
<head>
    <title>급식 정보 조회</title>
</head>
<body>
    <h1>급식 정보</h1>

    <section>
        <h2>오늘의 급식</h2>
        <div id="resultToday"></div>
    </section>

    <section>
        <h2>내일의 급식</h2>
        <div id="resultTomorrow"></div>
    </section>

    <script>
        function fetchMealInfo(date, elementId) {
            var url = new URL("https://open.neis.go.kr/hub/mealServiceDietInfo")

            var params = {
                KEY: '7a8edb3d57f14ce5b301917d8922f9bb',
                Type: 'json',
                pIndex: 1,
                pSize: 10,
                ATPT_OFCDC_SC_CODE: 'C10',
                SD_SCHUL_CODE: '7150597',
                MLSV_YMD: date,
            }

            Object.keys(params).forEach(key => url.searchParams.append(key, params[key]))

            fetch(url, {
                method: 'GET',
            })
            .then(response => response.json())
            .then(json => {
                var resultEl = document.getElementById(elementId);
                var mealInfo = json.mealServiceDietInfo[1].row[0];
                resultEl.innerHTML = `
                    <p>급식일자: ${mealInfo.MLSV_YMD}</p>
                    <p>급식: ${mealInfo.DDISH_NM.replace(/<br\/>/g, ', ')}</p>
                `;
            })
            .catch(err => {
                var resultEl = document.getElementById(elementId);
                resultEl.innerHTML = `<p>급식 정보가 없습니다.</p>`;
            });

        }

        var today = new Date();
        var tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        var todayStr = today.toISOString().split('T')[0].replace(/-/g, '');
        var tomorrowStr = tomorrow.toISOString().split('T')[0].replace(/-/g, '');

        fetchMealInfo(todayStr, 'resultToday');
        fetchMealInfo(tomorrowStr, 'resultTomorrow');
    </script>
</body>
</html>
